---
date: 2025-09-05
aliases:
tags:
  - Docker部署软件
  - 容器
  - 镜像
  - 数据卷
  - 本地目录挂载
  - 自定义镜像
  - 自定义网络
  - DockerCompose一键部署
---
# Docker
---
### 1、定义
	快速构建、运行、管理应用的工具
### 2、镜像和容器
	当利用Docker安装应用的是后，Docker会自动搜索并下载应用的镜像，镜像不止包含本身，还包括运行时的环境、配置、系统函数库，Docker会在运行镜像时创建一个隔离环境，称为容器。
### 3、在Docker中安装mysql
	（1）拉取镜像
```shell
docker pull mysql:8.0
```
	（2）启动mysql容器
```shell
docker run -d \
  --name mysql-container \
  -e MYSQL_ROOT_PASSWORD=123456 \
  -p 3306:3306 \
  -v mysql_data:/var/lib/mysql \
  mysql:8.0
```
	-d：后台运行
    
- `--name`：容器名称
    
- `-e MYSQL_ROOT_PASSWORD=123456`：设置 root 密码
    
- `-p 3306:3306`：宿主机端口:容器端口
    
- `-v mysql_data:/var/lib/mysql`：把数据库数据持久化到本地
	（3）测试连接
```shell
docker exec -it mysql-container mysql -uroot -p
```
## Docker基础
---
### 1、常见命令
![[Pasted image 20250905111937.png]]
### 2、使用
	save：
		docker save -0 文件名（带后缀） 镜像名称（例如，Nginx:latest）
	rmi:
		docker rmi 镜像名称（例如，Nginx:latest）
	load：
		docker load 文件名（带后缀）
	logs：
		docker logs -f（持续该跟踪加） 容器名
	exec：
		docker exec -it（创建控制台） 容器名 bash（交互语言）
	rm:
		docker rm 容器名（先停掉该容器才能删除）
## 数据卷
---
### 1、定义
	是一个虚拟目录，是容器内目录与宿主机目录之间映射的桥梁
	解决的问题：
		当想对于容器内部的文件进行修改时非常困难，因为想vi之类的操作软件都没有，难以操作
### 2、实现流程图
![[Pasted image 20250905122929.png]]
### 3、常见命令
![[Pasted image 20250905123051.png]]
### 4、流程
	（1）在创建容器的时候添加-v,文件名加路径名，如下面所示
```shell
docker run -d --name nginx-container -p 80:80 -v html:usr/share/nginx/html nginx:stable-alpine3.21-perl
```
	（2）查找数据卷存放路径
```shell
docker volume inspect html
```
	（3）找到对应文件，进行修改
## 本地目录挂载
---
### 1、解决的问题
	有些软件在创建的时候默认会创建数据卷，例如，mysql，如果每次容器删除，更新、重新加载容器的时候，可能数据迁移会出现问题。
## 2、实现
	创建容器的时候，类似于数据卷，添加-v 本地目录:容器目录，实现本地目录挂在
	注意：
		在声明本地目录的时候一定要在开头添加"./"或"/"，否则会被识别为数据卷名
	演示：这里的“\”可以省略，写在一行也可以
```shell
docker run -d \
  --name mysql-container \
  -e MYSQL_ROOT_PASSWORD=123456 \
  -p 3306:3306 \
  -v /root/mysql/data:/var/lib/mysql \
  -v /root/mysql/init:/docker-entrypoint-initdb.d \
  -v /root/mysql/conf:/etc/mysql/conf.d \
  mysql:8.0
```
## 自定义镜像
---
### 1、定义
	镜像本身包含了应用程序、程序运行的函数库、运行配置等文件的文件包，构建镜像的过程就是把上述
	打包的过程
### 2、构建一个镜像
	步骤：
		准备Linux运行环境
		安装jre并配置环境变量
		拷贝jar包
		编写运行脚本
	镜像结构：

![[Pasted image 20250906061814.png]]
### 3、DockerFile
	定义：是一个文本文件，用指令来表明执行什么操作来构建镜像，
	常见指令如下

![[Pasted image 20250906062017.png]]
	流程

![[Pasted image 20250906062804.png]]
### 4、演示（Nginx项目）
	（1）导入Nginx项目到Linux中的指定文件
	（2）在Nginx项目内部文件内书写Dockerfile文件
```shell
FROM nginx:1.18
#设置工作目录
WORKDIR /nginx-test/nginx
#覆盖默认配置
COPY conf/ /etc/nginx/
# 复制前端静态资源到容器内
COPY html/ /usr/share/nginx/html/
#复制 contrib
COPY contrib/ /usr/share/nginx/contrib/
# 暴露端口
EXPOSE 80
# 启动 nginx（必须以前台方式）
CMD ["nginx", "-g", "daemon off;"]
```
	（3）构建镜像
```shell
docker build -t my-nginx .
```
	（4）构建对应容器即可
### 5、jar部署
	 和上面的步骤类似
	Dockerfile改为

![[Pasted image 20250906101545.png]]

## Docker Compose
---
#### (1)定义
![[Pasted image 20250906102255.png]]
#### （2）常用指令
![[Pasted image 20250906102949.png]]
### （3）编写DockerCompose文件
![[Pasted image 20250906103716.png]]
![[Pasted image 20250906103726.png]]
### 注：==在用Docker部署项目的时候，最好自定义一个网络，这样可以直接通过容器名访问，避免了默认网桥的动态分配IP地址；在项目中相关访问IP地址的，例如，mysql、Redis一般yml文件的数据可以调用副yml，最好两个，一个本地开发，一个部署用；即一个写死IP地址，另一个不用。==
