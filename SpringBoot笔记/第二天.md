---
date: 2025-07-21
aliases:
  - 黑马SpringBoot[11-20]
tags:
  - 自动配置原理
  - 依赖管理
  - SpringBoot开发程度
  - 自定义starter
---
### 自动配置原理
---
#### 1、定义：在boot程序启动后，起步依赖中 的一些bean对象会自动注入到IOC容器中
#### 2、实现
```java
//HelloAutoConfig.java

@AutoConfiguration  
@Import(HelloConfig.class)  
public class HelloAutoConfig {  
    public HelloAutoConfig() {  
    }}
```

#### 3、规则：SpringBoot只会扫描主程序所在的包和其所在的子包
#### 4、自定义扫描路径
	@SpringBootApplication（scanBasePackages=“包的位置”）
	配置文件的所有配置项是和某个类的对象值进行一一绑定的
#### 5、配置属性类
	绑定了配置文件的每一项值的类称为配置属性类
#### 6、按需配置：根据引用不同，导入的也不同



### 属性绑定
---
#### @ConfigurationProperties
	声明组件中的属性和配置文件的哪些前缀开始的项进行绑定
#### @EnableConfigurationProperties
	快速注册注解
	主要用于第三方包的配置时使用


## 自动配置类的深入解析
---
### SpringBoot的开发流程
	1、导入starter-web，导入了web开发场景
		（1）场景启动器导入了各种web开发会使用的各种依赖
		（2）每个启动器都会引入starter，核心场景启动器
		（3）核心场景启动器引入了spring-boot-autoConfigure包
		（4）spring-boot-autoConfigure包含了所有场景的配置
		（5）SpringBoot默认不会扫描spring-boot-autoConfigure下写好的配置类
	2、主程序：标注@SpringBootApplication
		（1）@SpringBootApplcation由三个注解组成，@SpringBootConfigure（声明配置类）、
		 EnableAutoConfiguration、componentScan（扫描指定的组件包）
		 （2）SpringBoot只能扫描自己所在的包和子包，扫描不到Spring-boot-autoConfigure
		 （3）@EnableAutoConfiguration：SpringBoot开启自动配置的核心
				1、由@Import（AutoConfigurationImportSelector.class）提供功能：批量的
					给容器导入组件
				2、SpringBoot启动默认会加载142个配置类
				3、项目启动的时候会利用@Import的批量导入机制包autoConfigure包下的142个
					xxxAutoConfiguration类（自动配置类）导入进来
				4、按需生效，只有对应的条件注解满足，才会真正的生效
	3、写业务，无需过度关注各种整合

### SpringBoot的开发程度
---
#### 1、普通开发：导入starter，写业务代码，有时修改配置文件
#### 2、高级开发：自定义组件、自定义配置、自定义starter


### 自定义Starter
---
#### （1）建立starter模块和autoConfigure模块
![[Pasted image 20250721120423.png]]
#### （2）创建并编译自动配置类
```java
@AutoConfiguration  //标识是自动配置类  
public class MyBatisAutoConfig {  
//    SqlSessionFactory  
    @Bean  
    SqlSessionFactoryBean sqlSessionFactoryBean(DataSource dataSource){  
        SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();  
        sqlSessionFactoryBean.setDataSource(dataSource);  
  
        return sqlSessionFactoryBean;  
    }  
  
    @Bean  
//  MapperScannerConfigure  
    MapperScannerConfigurer mapperScannerConfigurer(BeanFactory beanFactory){  
        MapperScannerConfigurer mapperScannerConfigurer = new MapperScannerConfigurer();  
//      设置扫描的包：启动类所在的包和其子包  
//      存放的就是包名  
        List<String> pages = AutoConfigurationPackages.get(beanFactory);  
        String s = pages.get(0);  //由于只有一个包，所以可以直接获取第一个  
        mapperScannerConfigurer.setBasePackage(s);  
        //设置扫描的注解  
        mapperScannerConfigurer.setAnnotationClass(Mapper.class);  
  
        return mapperScannerConfigurer;  
    }  
}
```

#### （3）在starter模块中导入auto-Configure模块
```xml
<!--pom.xml-->

<dependency>  
    <groupId>com.kewen.mzc</groupId>  
    <artifactId>dmybatis-spring-boot-autoconfigure</artifactId>  
    <version>1.0-SNAPSHOT</version>  
</dependency>
```

#### （4）加入修改发行版号的插件（两个模块都要）
```xml
<!--pom.xml-->

<build>  
    <plugins>  
        <plugin>  
            <groupId>org.apache.maven.plugins</groupId>  
            <artifactId>maven-compiler-plugin</artifactId>  
            <version>3.14.0</version>  
            <configuration>                <source>17</source>  
                <target>17</target>  
            </configuration>  
        </plugin>  
    </plugins>  
</build>
```

#### （5）将starter模块放入到主业务的pom.xml中
![[Pasted image 20250721120904.png]]
